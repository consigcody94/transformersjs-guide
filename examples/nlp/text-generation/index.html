<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Text Generation - Transformers.js</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }

    h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 32px;
    }

    .subtitle {
      color: #666;
      margin-bottom: 30px;
    }

    .model-select {
      margin-bottom: 20px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 12px;
    }

    .model-select label {
      display: block;
      margin-bottom: 10px;
      font-weight: 600;
    }

    .model-select select {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
    }

    textarea {
      width: 100%;
      padding: 15px;
      font-size: 16px;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      resize: vertical;
      font-family: inherit;
      min-height: 100px;
    }

    textarea:focus {
      outline: none;
      border-color: #667eea;
    }

    .controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }

    .control-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .control-group label {
      font-size: 14px;
      font-weight: 600;
      color: #333;
    }

    .control-group input[type="range"] {
      width: 100%;
    }

    .control-value {
      font-size: 14px;
      color: #667eea;
      font-weight: 600;
    }

    button {
      padding: 15px 30px;
      font-size: 16px;
      font-weight: 600;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      width: 100%;
      margin-top: 15px;
      transition: transform 0.2s;
    }

    button:hover:not(:disabled) {
      transform: translateY(-2px);
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .output-box {
      margin-top: 30px;
      padding: 25px;
      background: #f8f9fa;
      border-radius: 16px;
      min-height: 150px;
      display: none;
    }

    .output-box.active {
      display: block;
    }

    .output-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .output-text {
      font-size: 16px;
      line-height: 1.8;
      color: #333;
      white-space: pre-wrap;
      font-family: 'Georgia', serif;
    }

    .generated {
      color: #667eea;
      font-weight: 500;
    }

    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 20px;
      padding-top: 20px;
      border-top: 2px solid #e0e0e0;
    }

    .stat-card {
      text-align: center;
    }

    .stat-label {
      font-size: 12px;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .stat-value {
      font-size: 20px;
      font-weight: 700;
      color: #667eea;
      margin-top: 5px;
    }

    .examples {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 10px;
      margin-top: 15px;
    }

    .example-btn {
      padding: 10px 15px;
      background: #f0f0f0;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      text-align: left;
      font-size: 14px;
      transition: background 0.2s;
    }

    .example-btn:hover {
      background: #e0e0e0;
    }

    .loading {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .typewriter {
      animation: blink 1s step-end infinite;
    }

    @keyframes blink {
      50% { opacity: 0; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>‚ú® AI Text Generation</h1>
    <p class="subtitle">Generate creative text with GPT-style language models</p>

    <div class="model-select">
      <label for="model">Select Model:</label>
      <select id="model">
        <option value="onnx-community/gpt2">GPT-2 (124M) - Fast, creative</option>
        <option value="onnx-community/distilgpt2">DistilGPT2 (82M) - Faster, smaller</option>
        <option value="onnx-community/Qwen2.5-0.5B-Instruct">Qwen 0.5B - Instruction-tuned</option>
      </select>
    </div>

    <div>
      <label style="display: block; margin-bottom: 10px; font-weight: 600;">Enter your prompt:</label>
      <textarea id="prompt" placeholder="Once upon a time in a galaxy far, far away...">Once upon a time</textarea>
    </div>

    <div style="margin-top: 20px;">
      <h3 style="margin-bottom: 10px;">Example Prompts:</h3>
      <div class="examples">
        <button class="example-btn" onclick="setPrompt('Write a short story about a robot learning to feel emotions.')">Robot emotions story</button>
        <button class="example-btn" onclick="setPrompt('Explain quantum computing in simple terms:')">Quantum computing</button>
        <button class="example-btn" onclick="setPrompt('Create a recipe for chocolate chip cookies:')">Cookie recipe</button>
        <button class="example-btn" onclick="setPrompt('Write a haiku about artificial intelligence:')">AI haiku</button>
      </div>
    </div>

    <div class="controls">
      <div class="control-group">
        <label>Max Tokens: <span class="control-value" id="maxTokensValue">100</span></label>
        <input type="range" id="maxTokens" min="10" max="500" value="100" step="10">
      </div>
      <div class="control-group">
        <label>Temperature: <span class="control-value" id="temperatureValue">0.9</span></label>
        <input type="range" id="temperature" min="0.1" max="2.0" value="0.9" step="0.1">
      </div>
      <div class="control-group">
        <label>Top-K: <span class="control-value" id="topKValue">50</span></label>
        <input type="range" id="topK" min="1" max="100" value="50" step="1">
      </div>
      <div class="control-group">
        <label>Top-P: <span class="control-value" id="topPValue">0.95</span></label>
        <input type="range" id="topP" min="0.1" max="1.0" value="0.95" step="0.05">
      </div>
    </div>

    <button id="generateBtn">
      <span id="generateText">Generate Text</span>
    </button>

    <div class="output-box" id="outputBox">
      <div class="output-header">
        <h3>Generated Text</h3>
        <button style="padding: 8px 16px; width: auto; margin: 0;" onclick="copyOutput()">üìã Copy</button>
      </div>
      <div class="output-text" id="outputText"></div>
      <div class="stats">
        <div class="stat-card">
          <div class="stat-label">Generation Time</div>
          <div class="stat-value" id="genTime">-</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Tokens Generated</div>
          <div class="stat-value" id="tokensGenerated">-</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Tokens/Second</div>
          <div class="stat-value" id="tokensPerSec">-</div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Words</div>
          <div class="stat-value" id="wordCount">-</div>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { pipeline } from 'https://cdn.jsdelivr.net/npm/@huggingface/transformers@3.7.6';

    let generator = null;
    let currentModel = 'onnx-community/gpt2';

    // Update control values
    document.getElementById('maxTokens').addEventListener('input', (e) => {
      document.getElementById('maxTokensValue').textContent = e.target.value;
    });

    document.getElementById('temperature').addEventListener('input', (e) => {
      document.getElementById('temperatureValue').textContent = e.target.value;
    });

    document.getElementById('topK').addEventListener('input', (e) => {
      document.getElementById('topKValue').textContent = e.target.value;
    });

    document.getElementById('topP').addEventListener('input', (e) => {
      document.getElementById('topPValue').textContent = e.target.value;
    });

    // Set example prompt
    window.setPrompt = function(text) {
      document.getElementById('prompt').value = text;
    };

    // Copy output
    window.copyOutput = async function() {
      const text = document.getElementById('outputText').textContent;
      await navigator.clipboard.writeText(text);
      const btn = event.target;
      const originalText = btn.textContent;
      btn.textContent = '‚úÖ Copied!';
      setTimeout(() => btn.textContent = originalText, 2000);
    };

    // Initialize model
    async function initModel() {
      const generateBtn = document.getElementById('generateBtn');
      const generateText = document.getElementById('generateText');

      try {
        generateText.innerHTML = '<div class="loading"></div> Loading model...';
        generateBtn.disabled = true;

        generator = await pipeline('text-generation', currentModel);

        generateText.textContent = 'Generate Text';
        generateBtn.disabled = false;

        console.log('‚úÖ Model loaded:', currentModel);
      } catch (error) {
        console.error('‚ùå Model load failed:', error);
        generateText.textContent = 'Model Load Failed';
      }
    }

    // Model change
    document.getElementById('model').addEventListener('change', (e) => {
      currentModel = e.target.value;
      generator = null;
      initModel();
    });

    // Generate
    document.getElementById('generateBtn').addEventListener('click', async () => {
      if (!generator) {
        await initModel();
        return;
      }

      const prompt = document.getElementById('prompt').value.trim();
      if (!prompt) {
        alert('Please enter a prompt!');
        return;
      }

      const generateBtn = document.getElementById('generateBtn');
      const generateText = document.getElementById('generateText');
      const outputBox = document.getElementById('outputBox');
      const outputText = document.getElementById('outputText');

      generateBtn.disabled = true;
      generateText.innerHTML = '<div class="loading"></div> Generating...';
      outputBox.classList.add('active');

      // Get parameters
      const maxTokens = parseInt(document.getElementById('maxTokens').value);
      const temperature = parseFloat(document.getElementById('temperature').value);
      const topK = parseInt(document.getElementById('topK').value);
      const topP = parseFloat(document.getElementById('topP').value);

      try {
        const startTime = performance.now();

        const result = await generator(prompt, {
          max_new_tokens: maxTokens,
          temperature: temperature,
          top_k: topK,
          top_p: topP,
          do_sample: true,
        });

        const generationTime = performance.now() - startTime;
        const generatedText = result[0].generated_text;

        // Extract only the new text (after prompt)
        const newText = generatedText.slice(prompt.length);
        const tokensGenerated = newText.split(/\s+/).length;
        const tokensPerSecond = (tokensGenerated / (generationTime / 1000)).toFixed(1);

        // Display with prompt in normal color and generated in highlight
        outputText.innerHTML = `${prompt}<span class="generated">${newText}</span>`;

        // Update stats
        document.getElementById('genTime').textContent = `${(generationTime / 1000).toFixed(2)}s`;
        document.getElementById('tokensGenerated').textContent = tokensGenerated;
        document.getElementById('tokensPerSec').textContent = tokensPerSecond;
        document.getElementById('wordCount').textContent = generatedText.split(/\s+/).length;

        console.log('Generated:', generatedText);
        console.log('Time:', generationTime, 'ms');
        console.log('Tokens/sec:', tokensPerSecond);

      } catch (error) {
        console.error('Generation failed:', error);
        outputText.innerHTML = `<span style="color: #dc3545;">‚ùå Generation failed: ${error.message}</span>`;
      } finally {
        generateBtn.disabled = false;
        generateText.textContent = 'Generate Again';
      }
    });

    // Initialize on load
    initModel();
  </script>
</body>
</html>
